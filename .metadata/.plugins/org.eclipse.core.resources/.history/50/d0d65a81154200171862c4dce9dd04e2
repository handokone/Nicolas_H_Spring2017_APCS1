package textExcel;

public class FormulaCell extends RealCell{

	private String userInput = "";
	private Spreadsheet spread;
	
	public FormulaCell(String formula){ 
		super(formula);
		userInput = formula;
	}
	
	public FormulaCell(String formula, Spreadsheet spr){
		super(formula);
		userInput = formula;
		spread = spr;
	}
	
	//from RealCell
	public String abbreviatedCellText(){
		return (getDoubleValue() + "          ").substring(0, 10);
	}
	
	//from RealCell
	public String fullCellText(){
		return userInput;
	}
	public double getDoubleValue(){
		double num;
		//Gets rid of paranthesis
		String form = userInput.substring(2, userInput.length() - 2);
		//Organize formula in an array of operators and operands. 
		String[] formulaArr = form.split(" ");
		//See if trying to find sum or average. 
		if(formulaArr[0].toUpperCase().equals("SUM")){
			return sum(formulaArr[1]);
		}else if(formularArr[0].toUpperCase().equals("AVG")){
			return avg(formulaArr[1]);
		}
		double finalVal = Double.parseDouble(formulaArr[0]);
		for(int i = 2; i < formulaArr.length; i += 2){
			num = Double.parseDouble(formulaArr[i]);
			if(formulaArr[i - 1].equals("*")){
				finalVal *= num;
			}else if(formulaArr[i - 1].equals("/")){
				finalVal /= num;
			}else if(formulaArr[i - 1].equals("+")){
				finalVal += num;
			}else if(formulaArr[i - 1].equals("-")){
				finalVal -= num;
			}
		}
		return finalVal;
	}
	
	public double sum(String cellRange){
		String[] cell = cellRange.split("-");
		double sum = 0.0;
		char firstName = cell[0].toLowerCase().charAt(0);
		char secondName = cell[1].toLowerCase().charAt(0);
		int firstCellNum = Integer.parseInt(cell[0].substring(1));
		int secondCellNum = Integer.parseInt(cell[1].substring(1));
		for(char i = firstName; i <= secondName; i++){
			for(int j = firstCellNum; j <= secondCellNum; j++){
				SpreadsheetLocation loc = new SpreadsheetLocation(i + j + "");
				Cell grid = spread.getCell(loc);
				sum += ((RealCell) grid).getDoubleValue();
			}
		}
		return sum;
	}
	
	public double avg(String cellRange){
		String[] cell = cellRange.split("-");
		double sum = 0.0;
		int div = 0;
		char firstName = cell[0].toLowerCase().charAt(0);
		char secondName = cell[1].toLowerCase().charAt(0);
		int firstCellNum = Integer.parseInt(cell[0].substring(1));
		int secondCellNum = Integer.parseInt(cell[1].substring(1));
		for(char i = firstName; i <= secondName; i++){
			for(int j = firstCellNum; j <= secondCellNum; j++){
				SpreadsheetLocation loc = new SpreadsheetLocation(i + j + "");
				Cell grid = spread.getCell(loc);
				sum += ((RealCell) grid).getDoubleValue();
				div++;
			}
		}
		sum = sum/div;
		return sum;
	}
	
}
